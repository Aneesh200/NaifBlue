generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String     @id @default(uuid())
  email              String     @unique
  name               String?
  phone              String?
  auth_type          String     @default("email")
  role               String     @default("user")
  default_address_id String?    @unique
  created_at         DateTime   @default(now())
  updated_at         DateTime   @updatedAt
  addresses          Address[]
  cart_items         CartItem[]
  orders             Order[]
  default_address    Address?   @relation("DefaultAddress", fields: [default_address_id], references: [id])
  wishlist           Wishlist?

  @@map("users")
}

model Product {
  id              String         @id @default(uuid())
  name            String
  description     String?
  price           Float
  images          String[]       @default([])
  in_stock        Boolean        @default(true)
  is_active       Boolean        @default(true)
  created_at      DateTime       @default(now())
  updated_at      DateTime       @updatedAt
  school_id       String?
  category_id     String?
  inventory_count Int            @default(100)
  cart_items      CartItem[]
  order_items     OrderItem[]
  product_sizes   ProductSize[]
  category        Category?      @relation(fields: [category_id], references: [id])
  school          School?        @relation(fields: [school_id], references: [id])
  wishlist_items  WishlistItem[]

  @@index([category_id])
  @@index([school_id])
  @@index([is_active])
  @@map("products")
}

model CartItem {
  id              String      @id @default(uuid())
  user_id         String
  product_id      String
  quantity        Int         @default(1)
  created_at      DateTime    @default(now())
  updated_at      DateTime    @updatedAt
  product_size_id String
  product         Product     @relation(fields: [product_id], references: [id])
  product_size    ProductSize @relation(fields: [product_size_id], references: [id])
  user            User        @relation(fields: [user_id], references: [id])

  @@unique([user_id, product_id, product_size_id])
  @@index([user_id])
  @@index([product_id])
  @@map("cart_items")
}

model Order {
  id                String           @id @default(uuid())
  user_id           String
  shipping_address  Json
  status            String
  total_amount      Float
  payment_intent_id String?
  payment_id        String?
  payment_status    String           @default("pending")
  created_at        DateTime         @default(now())
  updated_at        DateTime         @updatedAt
  items             OrderItem[]
  status_logs       OrderStatusLog[]
  user              User             @relation(fields: [user_id], references: [id])

  @@index([user_id])
  @@map("orders")
}

model OrderItem {
  id              String      @id @default(uuid())
  order_id        String
  product_id      String
  price           Float
  quantity        Int
  created_at      DateTime    @default(now())
  product_size_id String
  order           Order       @relation(fields: [order_id], references: [id])
  product         Product     @relation(fields: [product_id], references: [id])
  product_size    ProductSize @relation(fields: [product_size_id], references: [id])

  @@index([order_id])
  @@index([product_id])
  @@map("order_items")
}

model School {
  id                   String    @id @default(uuid())
  name                 String
  address              String?
  contact_number       String?
  uniform_requirements String?
  logo_url             String?
  created_at           DateTime  @default(now())
  updated_at           DateTime  @updatedAt
  products             Product[]

  @@map("schools")
}

model Address {
  id               String   @id @default(uuid())
  user_id          String
  address_line1    String
  address_line2    String?
  city             String
  state            String
  postal_code      String
  country          String
  is_default       Boolean  @default(false)
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt
  user             User     @relation(fields: [user_id], references: [id])
  default_for_user User?    @relation("DefaultAddress")

  @@index([user_id])
  @@map("addresses")
}

model Category {
  id         String    @id @default(uuid())
  name       String    @unique
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  products   Product[]

  @@map("categories")
}

model ProductSize {
  id          String      @id @default(uuid())
  product_id  String
  size        String
  age_range   String?
  stock       Int         @default(0)
  created_at  DateTime    @default(now())
  updated_at  DateTime    @updatedAt
  cart_items  CartItem[]
  order_items OrderItem[]
  product     Product     @relation(fields: [product_id], references: [id])

  @@unique([product_id, size])
  @@index([product_id])
  @@map("product_sizes")
}

model Wishlist {
  id         String         @id @default(uuid())
  user_id    String         @unique
  created_at DateTime       @default(now())
  updated_at DateTime       @updatedAt
  items      WishlistItem[]
  user       User           @relation(fields: [user_id], references: [id])

  @@map("wishlists")
}

model WishlistItem {
  id          String   @id @default(uuid())
  wishlist_id String
  product_id  String
  created_at  DateTime @default(now())
  product     Product  @relation(fields: [product_id], references: [id])
  wishlist    Wishlist @relation(fields: [wishlist_id], references: [id])

  @@unique([wishlist_id, product_id])
  @@index([wishlist_id])
  @@index([product_id])
  @@map("wishlist_items")
}

model Coupon {
  id          String    @id @default(uuid())
  code        String    @unique
  discount    Float
  is_percent  Boolean   @default(true)
  min_amount  Float?
  max_uses    Int?
  uses        Int       @default(0)
  valid_from  DateTime  @default(now())
  valid_until DateTime?
  is_active   Boolean   @default(true)
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt

  @@map("coupons")
}

model OrderStatusLog {
  id         String   @id @default(uuid())
  order_id   String
  status     String
  notes      String?
  updated_by String
  created_at DateTime @default(now())
  order      Order    @relation(fields: [order_id], references: [id])

  @@index([order_id])
  @@map("order_status_logs")
}

model Testimonial {
  id          String   @id @default(uuid())
  name        String
  role        String?
  school_name String?
  content     String
  rating      Int      @default(5)
  image_url   String?
  is_featured Boolean  @default(false)
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  @@map("testimonials")
}

model PortfolioItem {
  id          String   @id @default(uuid())
  title       String
  description String?
  image_url   String
  school_name String?
  category    String?
  year        Int?
  is_featured Boolean  @default(false)
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  @@map("portfolio_items")
}
